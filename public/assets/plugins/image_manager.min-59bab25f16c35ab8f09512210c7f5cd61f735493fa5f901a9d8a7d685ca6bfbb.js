/*!
 * froala_editor v2.1.0 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms
 * Copyright 2014-2016 Froala Labs
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(a,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(a)),e(t),t}:e(jQuery)}(function(e){"use strict";if(e.extend(e.FroalaEditor.DEFAULTS,{imageManagerLoadURL:"http://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:"",imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),e.FroalaEditor.PLUGINS.imageManager=function(a){function t(){x.show(),I.show(),G=a.image.get(),S||L(),g(),a.$document.find("body").addClass("prevent-scroll"),a.helpers.isMobile()&&a.$document.find("body").addClass("fr-mobile")}function r(){a.events.enableBlur(),x.hide(),I.hide(),a.$document.find("body").removeClass("prevent-scroll fr-mobile")}function i(){var a=e(window).outerWidth();return 768>a?2:1200>a?3:4}function n(){T.empty();for(var e=0;k>e;e++)T.append('<div class="fr-list-column"></div>')}function o(){var t="";a.opts.theme&&(t=" "+a.opts.theme+"-theme");var r='<div class="fr-modal'+t+'"><div class="fr-modal-wrapper">';return r+='<div class="fr-modal-title"><div class="fr-modal-title-line"><i class="fa fa-bars fr-modal-more fr-not-available" id="fr-modal-more-'+a.id+'" title="'+a.language.translate("Tags")+'"></i><h4 data-text="true">'+a.language.translate("Manage Images")+'</h4><i title="'+a.language.translate("Cancel")+'" class="fa fa-times fr-modal-close" id="fr-modal-close-'+a.id+'"></i></div>',r+='<div class="fr-modal-tags" id="fr-modal-tags-'+a.id+'"></div>',r+="</div>",r+='<img class="fr-preloader" id="fr-preloader-'+a.id+'" alt="'+a.language.translate("Loading")+'.." src="'+a.opts.imageManagerPreloader+'" style="display: none;">',r+='<div class="fr-scroller" id="fr-scroller-'+a.id+'"><div class="fr-image-list" id="fr-image-list-'+a.id+'"></div></div>',r+="</div></div>",e(r)}function s(){x=o(),a.helpers.isMobile()||x.addClass("fr-desktop"),x.appendTo("body"),I=e('<div class="fr-overlay">').appendTo("body"),a.opts.theme&&I.addClass(a.opts.theme+"-theme"),r(),a.events.on("destroy",function(){x.removeData().remove(),I.removeData().remove()},!0)}function g(){S.show(),T.find(".fr-list-column").empty(),a.opts.imageManagerLoadURL?e.ajax({url:a.opts.imageManagerLoadURL,method:a.opts.imageManagerLoadMethod,data:a.opts.imageManagerLoadParams,dataType:"json",crossDomain:a.opts.requestWithCORS,xhrFields:{withCredentials:a.opts.requestWithCORS},headers:a.opts.requestHeaders}).done(function(e,t,r){a.events.trigger("imageManager.imagesLoaded",[e]),l(e,r.response),S.hide()}).fail(function(){var e=this.xhr();M(O,e.response||e.responseText)}):M(z)}function l(e,a){try{T.find(".fr-list-column").empty(),H=0,U=0,E=0,R=e,d()}catch(t){M($,a)}}function d(){if(U<R.length&&(T.outerHeight()<=P.outerHeight()+a.opts.imageManagerScrollOffset||P.scrollTop()+a.opts.imageManagerScrollOffset>T.outerHeight()-P.outerHeight())){H++;for(var e=a.opts.imageManagerPageSize*(H-1);e<Math.min(R.length,a.opts.imageManagerPageSize*H);e++)f(R[e])}}function f(t){var r=new Image,i=e('<div class="fr-image-container fr-empty fr-image-'+E++ +'" data-loading="'+a.language.translate("Loading")+'.." data-deleting="'+a.language.translate("Deleting")+'..">');p(!1),r.onload=function(){i.height(Math.floor(i.width()/r.width*r.height));var n=e("<img/>");if(t.thumb)n.attr("src",t.thumb);else{if(M(B,t),!t.url)return M(W,t),!1;n.attr("src",t.url)}if(t.url&&n.attr("data-url",t.url),t.tag)if(F.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),F.find(".fr-modal-tags").show(),t.tag.indexOf(",")>=0){for(var o=t.tag.split(","),s=0;s<o.length;s++)o[s]=o[s].trim(),0===q.find('a[title="'+o[s]+'"]').length&&q.append('<a role="button" title="'+o[s]+'">'+o[s]+"</a>");n.attr("data-tag",o.join())}else 0===q.find('a[title="'+t.tag.trim()+'"]').length&&q.append('<a role="button" title="'+t.tag.trim()+'">'+t.tag.trim()+"</a>"),n.attr("data-tag",t.tag.trim());for(var g in t)"thumb"!=g&&"url"!=g&&"tag"!=g&&n.attr("data-"+g,t[g]);i.append(n).append('<i class="fa fa-trash-o fr-delete-img" title="'+a.language.translate("Delete")+'"></i>').append('<i class="fa fa-plus fr-insert-img" title="'+a.language.translate("Insert")+'"></i>'),q.find(".fr-selected-tag").each(function(e,a){y(n,a.text)||i.hide()}),n.on("load",function(){i.removeClass("fr-empty"),i.height("auto"),U++;var e=u(parseInt(n.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);c(e),p(!1),U%a.opts.imageManagerPageSize===0&&d()}),a.events.trigger("imageManager.imageLoaded",[n])},r.onerror=function(){U++,i.remove();var e=u(parseInt(i.attr("class").match(/fr-image-(\d+)/)[1],10)+1);c(e),M(j,t),U%a.opts.imageManagerPageSize===0&&d()},r.src=t.url,m().append(i)}function m(){var a,t;return T.find(".fr-list-column").each(function(r,i){var n=e(i);0===r?(t=n.outerHeight(),a=n):n.outerHeight()<t&&(t=n.outerHeight(),a=n)}),a}function u(a){void 0===a&&(a=0);for(var t=[],r=E-1;r>=a;r--){var i=T.find(".fr-image-"+r);i.length&&(t.push(i),e('<div id="fr-image-hidden-container">').append(i),T.find(".fr-image-"+r).remove())}return t}function c(e){for(var a=e.length-1;a>=0;a--)m().append(e[a])}function p(e){if(void 0===e&&(e=!0),!x.is(":visible"))return!0;var t=i();if(t!=k){k=t;var r=u();n(),c(r)}var o=a.$window.height(),s=x.find(".fr-modal-wrapper"),g=parseFloat(s.css("margin-top"))+parseFloat(s.css("margin-bottom")),l=parseFloat(s.css("padding-top"))+parseFloat(s.css("padding-bottom")),f=parseFloat(s.css("border-top-width")),m=s.find("h4").outerHeight();P.height(Math.min(T.outerHeight(),o-g-l-m-f)),e&&d()}function h(t){var i=e(t.currentTarget).siblings("img");if(r(),a.image.showProgressBar(),G)G.trigger("click");else{a.events.focus(!0),a.selection.restore();var n=a.position.getBoundingRect(),o=n.left+n.width/2,s=n.top+n.height;a.popups.setContainer("image.insert",a.$box||e("body")),a.popups.show("image.insert",o,s)}var g={},l=i.data();for(var d in l)"url"!=d&&"tag"!=d&&(g[d]=l[d]);a.undo.saveStep(),a.image.insert(i.data("url"),!1,g,G)}function v(t){var r=e(t.currentTarget).siblings("img"),i=a.language.translate("Are you sure? Image will be deleted.");confirm(i)&&(a.opts.imageManagerDeleteURL?a.events.trigger("imageManager.beforeDeleteImage",[r])!==!1&&(r.parent().addClass("fr-image-deleting"),e.ajax({method:a.opts.imageManagerDeleteMethod,url:a.opts.imageManagerDeleteURL,data:e.extend({src:r.attr("src")},a.opts.imageManagerDeleteParams),crossDomain:a.opts.requestWithCORS,xhrFields:{withCredentials:a.opts.requestWithCORS},headers:a.opts.requestHeaders}).done(function(e){a.events.trigger("imageManager.imageDeleted",[e]);var t=u(parseInt(r.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);r.parent().remove(),c(t),p(!0)}).fail(function(){var e=this.xhr();M(_,e.response||e.responseText)})):M(A))}function M(t,r){t>=10&&20>t?S.hide():t>=20&&30>t&&e(".fr-image-deleting").removeClass("fr-image-deleting"),a.events.trigger("imageManager.error",[{code:t,message:N[t]},r])}function b(){var e=F.find(".fr-modal-title-line").outerHeight(),a=q.outerHeight();F.toggleClass(".fr-show-tags"),F.hasClass(".fr-show-tags")?(F.css("height",e+a),q.find("a").css("opacity",1)):(F.css("height",e),q.find("a").css("opacity",0))}function w(){var a=q.find(".fr-selected-tag");a.length>0?(T.find("img").parent().show(),a.each(function(a,t){T.find("img").each(function(a,r){var i=e(r);y(i,t.text)||i.parent().hide()})})):T.find("img").parent().show();var t=u();c(t),d()}function C(t){t.preventDefault();var r=e(t.currentTarget);r.toggleClass("fr-selected-tag"),a.opts.imageManagerToggleTags&&r.siblings("a").removeClass("fr-selected-tag"),w()}function y(e,a){for(var t=e.attr("data-tag").split(","),r=0;r<t.length;r++)if(t[r]==a)return!0;return!1}function L(){S=x.find("#fr-preloader-"+a.id),T=x.find("#fr-image-list-"+a.id),P=x.find("#fr-scroller-"+a.id),q=x.find("#fr-modal-tags-"+a.id),F=q.parent(),k=i(),n();var t=F.find(".fr-modal-title-line").outerHeight();F.css("height",t),P.css("margin-top",t),a.events.bindClick(x,"i#fr-modal-close-"+a.id,r),e(window).on("resize.imagemanager"+a.id,p),a.helpers.isMobile()&&(a.events.bindClick(T,"div.fr-image-container",function(a){x.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),e(a.currentTarget).addClass("fr-mobile-selected")}),x.on(a._mousedown,function(){x.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),a.events.bindClick(T,".fr-insert-img",h),a.events.bindClick(T,".fr-delete-img",v),x.on(a._mousedown+" "+a._mouseup,function(e){e.stopPropagation()}),x.on(a._mousedown,"*",function(){a.events.disableBlur()}),P.on("scroll",d),a.events.bindClick(x,"i#fr-modal-more-"+a.id,b),a.events.bindClick(q,"a",C),a.events.on("destroy",function(){e(window).off("resize.imagemanager"+a.id)},!0)}function D(){return a.$wp||"IMG"==a.$el.get(0).tagName?void s():!1}var x,S,T,P,q,F,I,R,H,U,E,k,j=10,O=11,z=12,$=13,B=14,W=15,_=21,A=22,N={};N[j]="Image cannot be loaded from the passed link.",N[O]="Error during load images request.",N[z]="Missing imageManagerLoadURL option.",N[$]="Parsing load response failed.",N[B]="Missing image thumb.",N[W]="Missing image URL.",N[_]="Error during delete image request.",N[A]="Missing imageManagerDeleteURL option.";var G;return{require:["image"],_init:D,show:t,hide:r}},!e.FroalaEditor.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");e.FroalaEditor.DEFAULTS.imageInsertButtons.push("imageManager"),e.FroalaEditor.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.imageManager.show()},plugin:"imageManager"}),e.FroalaEditor.DefineIcon("imageManager",{NAME:"folder"})});
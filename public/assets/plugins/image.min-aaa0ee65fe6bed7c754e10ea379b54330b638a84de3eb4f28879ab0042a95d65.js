/*!
 * froala_editor v2.2.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2016 Froala Labs
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,a){return void 0===a&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(a),a}:e(jQuery)}(function(e){"use strict";e.extend(e.FE.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),e.extend(e.FE.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageRemove","|","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUploadURL:"http://i.froala.com/upload",imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","svg+xml"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imageMinWidth:16,imageOutputWidth:!1}),e.FE.PLUGINS.image=function(t){function a(){var e=t.popups.get("image.insert"),a=e.find(".fr-image-by-url-layer input");a.val(""),me&&a.val(me.attr("src")),a.trigger("change")}function i(){var e=t.$tb.find('.fr-command[data-cmd="insertImage"]'),a=t.popups.get("image.insert");if(a||(a=O()),v(),!a.hasClass("fr-active"))if(t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",t.$tb),e.is(":visible")){var i=e.offset().left+e.outerWidth()/2,r=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("image.insert",i,r,e.outerHeight())}else t.position.forSelection(a),t.popups.show("image.insert")}function r(){var a=t.popups.get("image.edit");a||(a=c()),t.popups.setContainer("image.edit",e(t.opts.scrollableContainer)),t.popups.refresh("image.edit");var i=me.offset().left+me.outerWidth()/2,r=me.offset().top+me.outerHeight();t.popups.show("image.edit",i,r,me.outerHeight())}function n(){v()}function s(e){if(!e.hasClass("fr-dii")&&!e.hasClass("fr-dib")){var a=e.css("float");e.css("float","none"),"block"==e.css("display")?(e.css("float",a),t.opts.imageEditButtons.indexOf("imageAlign")>=0&&(0===parseInt(e.css("margin-left"),10)&&(e.attr("style")||"").indexOf("margin-right: auto")>=0?e.addClass("fr-fil"):0===parseInt(e.css("margin-right"),10)&&(e.attr("style")||"").indexOf("margin-left: auto")>=0&&e.addClass("fr-fir")),e.addClass("fr-dib")):(e.css("float",a),t.opts.imageEditButtons.indexOf("imageAlign")>=0&&("left"==e.css("float")?e.addClass("fr-fil"):"right"==e.css("float")&&e.addClass("fr-fir")),e.addClass("fr-dii")),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align","")}}function o(){for(var a="IMG"==t.$el.get(0).tagName?[t.$el.get(0)]:t.$el.get(0).querySelectorAll("img"),i=0;i<a.length;i++){var r=e(a[i]);(t.opts.imageEditButtons.indexOf("imageAlign")>=0||t.opts.imageEditButtons.indexOf("imageDisplay")>=0)&&s(r),r.attr("width")&&(r.css("width",r.width()),r.removeAttr("width")),t.opts.imageTextNear||r.removeClass("fr-dii").addClass("fr-dib"),t.opts.iframe&&r.on("load",t.size.syncIframe)}}function l(){var a,i=Array.prototype.slice.call(t.$el.get(0).querySelectorAll("img")),r=[];for(a=0;a<i.length;a++)r.push(i[a].getAttribute("src")),e(i[a]).toggleClass("fr-draggable",t.opts.imageMove);if(xe)for(a=0;a<xe.length;a++)r.indexOf(xe[a].getAttribute("src"))<0&&t.events.trigger("image.removed",[e(xe[a])]);xe=i}function f(){ce||K();var a=t.$wp||e(t.opts.scrollableContainer);a.append(ce),ce.data("instance",t);var i=a.scrollTop()-("static"!=a.css("position")?a.offset().top:0),r=a.scrollLeft()-("static"!=a.css("position")?a.offset().left:0);r-=t.helpers.getPX(a.css("border-left-width")),i-=t.helpers.getPX(a.css("border-top-width")),ce.css("top",(t.opts.iframe?me.offset().top:me.offset().top+i)-1).css("left",(t.opts.iframe?me.offset().left:me.offset().left+r)-1).css("width",me.get(0).getBoundingClientRect().width).css("height",me.get(0).getBoundingClientRect().height).addClass("fr-active")}function d(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function p(a){if(!t.core.sameInstance(ce))return!0;if(a.preventDefault(),a.stopPropagation(),t.$el.find("img.fr-error").left)return!1;t.undo.canDo()||t.undo.saveStep(),he=e(this),he.data("start-x",a.pageX||a.originalEvent.touches[0].pageX),he.data("start-width",me.width());var i=me.width();if(t.opts.imageResizeWithPercent){var r=me.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.$el.get(0);me.css("width",(i/e(r).outerWidth()*100).toFixed(2)+"%")}else me.css("width",i);ve.show(),t.popups.hideAll(),ae()}function g(a){if(!t.core.sameInstance(ce))return!0;if(he&&me){if(a.preventDefault(),t.$el.find("img.fr-error").left)return!1;var i=a.pageX||(a.originalEvent.touches?a.originalEvent.touches[0].pageX:null);if(!i)return!1;var r=he.data("start-x"),n=i-r,s=he.data("start-width");if((he.hasClass("fr-hnw")||he.hasClass("fr-hsw"))&&(n=0-n),t.opts.imageResizeWithPercent){var o=me.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.$el.get(0);s=((s+n)/e(o).outerWidth()*100).toFixed(2),t.opts.imageRoundPercent&&(s=Math.round(s)),me.css("width",s+"%")}else s+n>=t.opts.imageMinWidth&&me.css("width",s+n);me.css("height","").removeAttr("height"),f(),t.events.trigger("image.resize",[ge()])}}function u(e){if(!t.core.sameInstance(ce))return!0;if(he&&me){if(e&&e.stopPropagation(),t.$el.find("img.fr-error").left)return!1;he=null,ve.hide(),f(),r(),t.undo.saveStep(),t.events.trigger("image.resizeEnd",[ge()])}}function m(e,a){t.edit.on(),me&&me.addClass("fr-error"),y(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("image.error",[{code:e,message:$e[e]},a])}function c(e){if(e)return t.$wp&&t.events.$on(t.$wp,"scroll",function(){me&&t.popups.isVisible("image.edit")&&r()}),!0;var a="";t.opts.imageEditButtons.length>1&&(a+='<div class="fr-buttons">',a+=t.button.buildList(t.opts.imageEditButtons),a+="</div>");var i={buttons:a},n=t.popups.create("image.edit",i);return n}function h(a){var i=t.popups.get("image.insert");if(i||(i=O()),t.popups.setContainer("image.insert",e(t.opts.scrollableContainer)),i.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),i.find(".fr-image-progress-bar-layer").addClass("fr-active"),i.find(".fr-buttons").hide(),me){var r=me.offset().left+me.width()/2,n=me.offset().top+me.height();t.popups.show("image.insert",r,n,me.outerHeight())}"undefined"==typeof a&&b("Uploading",0)}function v(e){var a=t.popups.get("image.insert");a&&(a.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),a.find(".fr-image-progress-bar-layer").removeClass("fr-active"),a.find(".fr-buttons").show(),(e||t.$el.find("img.fr-error").length)&&(t.events.focus(),t.$el.find("img.fr-error").remove(),t.undo.saveStep(),t.undo.run(),t.undo.dropRedo()))}function b(e,a){var i=t.popups.get("image.insert");if(i){var r=i.find(".fr-image-progress-bar-layer");r.find("h3").text(e+(a?" "+a+"%":"")),r.removeClass("fr-error"),a?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width",a+"%")):r.find("div").addClass("fr-indeterminate")}}function y(e){var a=t.popups.get("image.insert"),i=a.find(".fr-image-progress-bar-layer");i.addClass("fr-error"),i.find("h3").text(e)}function w(){var e=t.popups.get("image.insert"),a=e.find(".fr-image-by-url-layer input");a.val().length>0&&(h(),b("Loading image"),A(t.helpers.sanitizeURL(a.val()),!0,[],me),a.val(""),a.blur())}function C(e){Z.call(e.get(0))}function E(){var a=e(this);t.popups.hide("image.insert"),a.removeClass("fr-uploading"),a.next().is("br")&&a.next().remove(),C(a),t.events.trigger("image.loaded",[a])}function A(e,a,i,r,n){t.edit.off(),b("Loading image");var s=new Image;s.onload=function(){var a,s;if(r){var o=r.data("fr-old-src");t.$wp?(a=r.clone().removeData("fr-old-src").removeClass("fr-uploading"),o&&r.attr("src",o),r.replaceWith(a),a.off("load")):a=r;for(var f=a.get(0).attributes,d=0;d<f.length;d++){var p=f[d];0===p.nodeName.indexOf("data-")&&a.removeAttr(p.nodeName)}if("undefined"!=typeof i)for(s in i)i.hasOwnProperty(s)&&"link"!=s&&a.attr("data-"+s,i[s]);a.on("load",E),a.attr("src",e),t.edit.on(),l(),t.undo.saveStep(),t.events.trigger(o?"image.replaced":"image.inserted",[a,n])}else a=D(e,i,E),l(),t.undo.saveStep(),t.events.trigger("image.inserted",[a,n])},s.onerror=function(){m(ye)},s.src=e}function S(a){try{if(t.events.trigger("image.uploaded",[a],!0)===!1)return t.edit.on(),!1;var i=e.parseJSON(a);return i.link?i:(m(we,a),!1)}catch(r){return m(Ee,a),!1}}function R(a){try{var i=e(a).find("Location").text(),r=e(a).find("Key").text();return t.events.trigger("image.uploadedToS3",[i,r,a],!0)===!1?(t.edit.on(),!1):i}catch(n){return m(Ee,a),!1}}function $(e){b("Loading image");var a=this.status,i=this.response,r=this.responseXML,n=this.responseText;try{if(t.opts.imageUploadToS3)if(201==a){var s=R(r);s&&A(s,!1,[],e,i||r)}else m(Ee,i||r);else if(a>=200&&300>a){var o=S(n);o&&A(o.link,!1,o,e,i||n)}else m(Ce,i||n)}catch(l){m(Ee,i||n)}}function x(){m(Ee,this.response||this.responseText||this.responseXML)}function I(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;b("Uploading",t)}}function D(a,i,r){var n,s="";if(i&&"undefined"!=typeof i)for(n in i)i.hasOwnProperty(n)&&"link"!=n&&(s+=" data-"+n+'="'+i[n]+'"');var o=t.opts.imageDefaultWidth||"auto";o&&"auto"!=o&&(""+o).indexOf("px")<0&&(""+o).indexOf("%")<0&&(o+="px");var l=e('<img class="fr-di'+t.opts.imageDefaultDisplay[0]+("center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:"")+'" src="'+a+'"'+s+(o?' style="width: '+o+';"':"")+">");l.on("load",r),t.edit.on(),t.events.focus(!0),t.selection.restore(),t.undo.saveStep(),t.opts.imageSplitHTML?t.markers.split():t.markers.insert();var f=t.$el.find(".fr-marker");return f.replaceWith(l),t.html.wrap(),t.selection.clear(),l}function k(a,i,r){function n(){var r=e(this);r.off("load"),r.addClass("fr-uploading"),r.next().is("br")&&r.next().remove(),t.placeholder.refresh(),r.is(me)||C(r),f(),h(),t.edit.off(),a.onload=function(){$.call(a,r)},a.onerror=x,a.upload.onprogress=I,a.send(i)}var s,o=new FileReader;o.addEventListener("load",function(){for(var e=atob(o.result.split(",")[1]),a=[],i=0;i<e.length;i++)a.push(e.charCodeAt(i));var r=window.URL.createObjectURL(new Blob([new Uint8Array(a)],{type:"image/jpeg"}));me?(me.on("load",n),t.edit.on(),t.undo.saveStep(),me.data("fr-old-src",me.attr("src")),me.attr("src",r)):s=D(r,null,n)},!1),o.readAsDataURL(r)}function U(e){if(t.events.trigger("image.beforeUpload",[e])===!1)return!1;if("undefined"!=typeof e&&e.length>0){var a=e[0];if(a.size>t.opts.imageMaxSize)return m(Ae),!1;if(t.opts.imageAllowedTypes.indexOf(a.type.replace(/image\//g,""))<0)return m(Se),!1;var i;if(t.drag_support.formdata&&(i=t.drag_support.formdata?new FormData:null),i){var r;if(t.opts.imageUploadToS3!==!1){i.append("key",t.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(a.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",a.type);for(r in t.opts.imageUploadToS3.params)t.opts.imageUploadToS3.params.hasOwnProperty(r)&&i.append(r,t.opts.imageUploadToS3.params[r])}for(r in t.opts.imageUploadParams)t.opts.imageUploadParams.hasOwnProperty(r)&&i.append(r,t.opts.imageUploadParams[r]);i.append(t.opts.imageUploadParam,a);var n=t.opts.imageUploadURL;t.opts.imageUploadToS3&&(n="https://"+t.opts.imageUploadToS3.region+".amazonaws.com/"+t.opts.imageUploadToS3.bucket);var s=t.core.getXHR(n,t.opts.imageUploadMethod);k(s,i,a)}}}function B(a){t.events.$on(a,"dragover dragenter",".fr-image-upload-layer",function(){return e(this).addClass("fr-drop"),!1}),t.events.$on(a,"dragleave dragend",".fr-image-upload-layer",function(){return e(this).removeClass("fr-drop"),!1}),t.events.$on(a,"drop",".fr-image-upload-layer",function(i){i.preventDefault(),i.stopPropagation(),e(this).removeClass("fr-drop");var r=i.originalEvent.dataTransfer;if(r&&r.files){var n=a.data("instance")||t;n.image.upload(r.files)}}),t.events.$on(a,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var i=a.data("instance")||t;i.image.upload(this.files)}e(this).val("")})}function P(a){var i=a.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var r=i.files[0];if(r&&r.type&&t.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))>=0){t.markers.remove(),t.markers.insertAtPoint(a.originalEvent),t.$el.find(".fr-marker").replaceWith(e.FE.MARKERS),t.popups.hideAll();var n=t.popups.get("image.insert");return n||(n=O()),t.popups.setContainer("image.insert",e(t.opts.scrollableContainer)),t.popups.show("image.insert",a.originalEvent.pageX,a.originalEvent.pageY),h(),U(i.files),a.preventDefault(),a.stopPropagation(),!1}}}function z(){t.events.$on(t.$el,t._mousedown,"IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',function(a){return e(this).parents('[contenteditable="false"]:not(.fr-element)').length?!0:(t.selection.clear(),be=!0,t.browser.msie&&(t.events.disableBlur(),t.$el.attr("contenteditable",!1)),t.draggable||a.preventDefault(),void a.stopPropagation())}),t.events.$on(t.$el,t._mouseup,"IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',function(a){return e(this).parents('[contenteditable="false"]:not(.fr-element)').length?!0:void(be&&(be=!1,a.stopPropagation(),t.browser.msie&&(t.$el.attr("contenteditable",!0),t.events.enableBlur())))}),t.events.on("drop",P),t.events.on("mousedown window.mousedown",te),t.events.on("window.touchmove",ae),t.events.on("mouseup window.mouseup",ee),t.events.on("commands.mousedown",function(e){e.parents(".fr-toolbar").length>0&&ee()}),t.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){be=!1,ee(!0)})}function O(e){if(e)return t.popups.onRefresh("image.insert",a),t.popups.onHide("image.insert",n),!0;var i,r="";t.opts.imageInsertButtons.length>1&&(r='<div class="fr-buttons">'+t.button.buildList(t.opts.imageInsertButtons)+"</div>");var s=t.opts.imageInsertButtons.indexOf("imageUpload"),o=t.opts.imageInsertButtons.indexOf("imageByURL"),l="";s>=0&&(i=" fr-active",o>=0&&s>o&&(i=""),l='<div class="fr-image-upload-layer'+i+' fr-layer" id="fr-image-upload-layer-'+t.id+'"><strong>'+t.language.translate("Drop image")+"</strong><br>("+t.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/*" tabIndex="-1"></div></div>');var f="";o>=0&&(i=" fr-active",s>=0&&o>s&&(i=""),f='<div class="fr-image-by-url-layer'+i+' fr-layer" id="fr-image-by-url-layer-'+t.id+'"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2">'+t.language.translate("Insert")+"</button></div></div>");var d='<div class="fr-image-progress-bar-layer fr-layer"><h3 class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-back" data-cmd="imageDismissError" tabIndex="2">OK</button></div></div>',p={buttons:r,upload_layer:l,by_url_layer:f,progress_bar:d},g=t.popups.create("image.insert",p);return t.$wp&&t.events.$on(t.$wp,"scroll",function(){me&&t.popups.isVisible("image.insert")&&fe()}),B(g),g}function _(){if(me){var e=t.popups.get("image.alt");e.find("input").val(me.attr("alt")||"").trigger("change")}}function T(){var a=t.popups.get("image.alt");a||(a=F()),v(),t.popups.refresh("image.alt"),t.popups.setContainer("image.alt",e(t.opts.scrollableContainer));var i=me.offset().left+me.width()/2,r=me.offset().top+me.height();t.popups.show("image.alt",i,r,me.outerHeight())}function F(e){if(e)return t.popups.onRefresh("image.alt",_),!0;var a="";a='<div class="fr-buttons">'+t.button.buildList(t.opts.imageAltButtons)+"</div>";var i="";i='<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+t.id+'"><div class="fr-input-line"><input type="text" placeholder="'+t.language.translate("Alternate Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2">'+t.language.translate("Update")+"</button></div></div>";var r={buttons:a,alt_layer:i},n=t.popups.create("image.alt",r);return t.$wp&&t.events.$on(t.$wp,"scroll.image-alt",function(){me&&t.popups.isVisible("image.alt")&&T()}),n}function L(e){if(me){var a=t.popups.get("image.alt");me.attr("alt",e||a.find("input").val()||""),a.find("input:focus").blur(),C(me)}}function N(){if(me){var e=t.popups.get("image.size");e.find('input[name="width"]').val(me.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(me.get(0).style.height).trigger("change")}}function M(){var a=t.popups.get("image.size");a||(a=W()),v(),t.popups.refresh("image.size"),t.popups.setContainer("image.size",e(t.opts.scrollableContainer));var i=me.offset().left+me.width()/2,r=me.offset().top+me.height();t.popups.show("image.size",i,r,me.outerHeight())}function W(e){if(e)return t.popups.onRefresh("image.size",N),!0;var a="";a='<div class="fr-buttons">'+t.button.buildList(t.opts.imageSizeButtons)+"</div>";var i="";i='<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+t.id+'"><div class="fr-image-group"><div class="fr-input-line"><input type="text" name="width" placeholder="'+t.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input type="text" name="height" placeholder="'+t.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2">'+t.language.translate("Update")+"</button></div></div>";var r={buttons:a,size_layer:i},n=t.popups.create("image.size",r);return t.$wp&&t.events.$on(t.$wp,"scroll.image-size",function(){me&&t.popups.isVisible("image.size")&&M()}),n}function H(e,a){if(me){var i=t.popups.get("image.size");me.css("width",e||i.find('input[name="width"]').val()),me.css("height",a||i.find('input[name="height"]').val()),i.find("input:focus").blur(),C(me)}}function j(e){var a,i,r=t.popups.get("image.insert");if(me||t.opts.toolbarInline)me&&(i=me.offset().top+me.outerHeight());else{var n=t.$tb.find('.fr-command[data-cmd="insertImage"]');a=n.offset().left+n.outerWidth()/2,i=n.offset().top+(t.opts.toolbarBottom?10:n.outerHeight()-10)}!me&&t.opts.toolbarInline&&(i=r.offset().top-t.helpers.getPX(r.css("margin-top")),r.hasClass("fr-above")&&(i+=r.outerHeight())),r.find(".fr-layer").removeClass("fr-active"),r.find(".fr-"+e+"-layer").addClass("fr-active"),t.popups.show("image.insert",a,i,me?me.outerHeight():0)}function X(e){var a=t.popups.get("image.insert");a.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active")}function G(e){var a=t.popups.get("image.insert");a.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active")}function K(){var a;t.shared.$image_resizer?(ce=t.shared.$image_resizer,ve=t.shared.$img_overlay,t.events.on("destroy",function(){ce.removeClass("fr-active").appendTo(e("body"))},!0)):(t.shared.$image_resizer=e('<div class="fr-image-resizer"></div>'),ce=t.shared.$image_resizer,t.events.$on(ce,"mousedown",function(e){e.stopPropagation()},!0),t.opts.imageResize&&(ce.append(d("nw")+d("ne")+d("sw")+d("se")),t.shared.$img_overlay=e('<div class="fr-image-overlay"></div>'),ve=t.shared.$img_overlay,a=ce.get(0).ownerDocument,e(a).find("body").append(ve))),t.events.on("shared.destroy",function(){ce.html("").removeData().remove(),t.opts.imageResize&&ve.remove()},!0),t.helpers.isMobile()||t.events.$on(e(t.o_win),"resize",function(){me&&!me.hasClass("fr-uploading")?ee(!0):me&&(f(),fe(),h(!1))}),t.opts.imageResize&&(a=ce.get(0).ownerDocument,t.events.$on(ce,t._mousedown,".fr-handler",p),t.events.$on(e(a),t._mousemove,g),t.events.$on(e(a.defaultView||a.parentWindow),t._mouseup,u),t.events.$on(ve,"mouseleave",u))}function Y(a){a=a||me,a&&t.events.trigger("image.beforeRemove",[a])!==!1&&(t.popups.hideAll(),ee(!0),a.get(0)==t.$el.get(0)?a.removeAttr("src"):("A"==a.get(0).parentNode.tagName?(t.selection.setBefore(a.get(0).parentNode)||t.selection.setAfter(a.get(0).parentNode),e(a.get(0).parentNode).remove()):(t.selection.setBefore(a.get(0))||t.selection.setAfter(a.get(0)),a.remove()),t.selection.restore(),t.html.fillEmptyBlocks()),t.undo.saveStep())}function q(){if(z(),"IMG"==t.$el.get(0).tagName&&t.$el.addClass("fr-view"),t.events.$on(t.$el,t.helpers.isMobile()&&!t.helpers.isWindowsPhone()?"touchend":"click","IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',Z),t.helpers.isMobile()&&(t.events.$on(t.$el,"touchstart","IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',function(){Ie=!1}),t.events.$on(t.$el,"touchmove",function(){Ie=!0})),t.events.on("window.keydown keydown",function(a){var i=a.which;return!me||i!=e.FE.KEYCODE.BACKSPACE&&i!=e.FE.KEYCODE.DELETE?me&&i==e.FE.KEYCODE.ESC?(ee(!0),a.preventDefault(),!1):me&&!t.keys.ctrlKey(a)?(a.preventDefault(),!1):void 0:(a.preventDefault(),a.stopPropagation(),Y(),!1)},!0),t.events.$on(e(t.o_win),"keydown",function(t){var a=t.which;return me&&a==e.FE.KEYCODE.BACKSPACE?(t.preventDefault(),!1):void 0}),t.events.on("paste.before",Q),t.events.on("paste.beforeCleanup",J),t.events.on("paste.after",V),t.events.on("html.set",o),o(),t.events.on("html.get",function(e){return e=e.replace(/<(img)((?:[\w\W]*?))class="([\w\W]*?)(fr-uploading|fr-error)([\w\W]*?)"((?:[\w\W]*?))>/g,"")}),t.opts.imageOutputWidth){var a;t.events.on("html.beforeGet",function(){a=t.$el.get(0).querySelectorAll("img");for(var i=0;i<a.length;i++)a[i].setAttribute("width",e(a[i]).width())}),t.events.on("html.afterGet",function(){for(var e=0;e<a.length;e++)a[e].removeAttribute("width")})}t.opts.iframe&&t.events.on("image.loaded",t.size.syncIframe),t.$wp&&(l(),t.events.on("contentChanged",l)),t.events.$on(e(t.o_win),"orientationchange.image",function(){setTimeout(function(){var e=ge();e&&C(e)},0)}),c(!0),O(!0),W(!0),F(!0),t.events.on("node.remove",function(e){return"IMG"==e.get(0).tagName?(Y(e),!1):void 0})}function V(){t.opts.imagePaste?t.$el.find("img[data-fr-image-pasted]").each(function(a,i){if(0===i.src.indexOf("data:")){if(t.events.trigger("image.beforePasteUpload",[i])===!1)return!1;var n=t.opts.imageDefaultWidth||"auto";"auto"!=n&&(n+=t.opts.imageResizeWithPercent?"%":"px"),e(i).css("width",n),e(i).addClass("fr-dib"),me=e(i),f(),r(),fe(),h(),t.edit.off();for(var s=atob(e(i).attr("src").split(",")[1]),o=[],l=0;l<s.length;l++)o.push(s.charCodeAt(l));var d=new Blob([new Uint8Array(o)],{type:"image/jpeg"});U([d]),e(i).removeAttr("data-fr-image-pasted")}else 0!==i.src.indexOf("http")?(t.selection.save(),e(i).remove(),t.selection.restore()):e(i).removeAttr("data-fr-image-pasted")}):t.$el.find("img[data-fr-image-pasted]").remove()}function Q(e){if(e&&e.clipboardData&&e.clipboardData.items&&e.clipboardData.items[0]){var a=e.clipboardData.items[0].getAsFile();if(a){var i=new FileReader;return i.onload=function(e){var a=e.target.result,i=t.opts.imageDefaultWidth||"auto";i&&"auto"!=i&&(""+i).indexOf("px")<0&&(""+i).indexOf("%")<0&&(i+="px"),t.html.insert('<img data-fr-image-pasted="true" class="fr-di'+t.opts.imageDefaultDisplay[0]+("center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:"")+'" src="'+a+'"'+(i?' style="width: '+i+';"':"")+">"),t.events.trigger("paste.after")},i.readAsDataURL(a),!1}}}function J(e){return e=e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function Z(a){if(e(this).parents('[contenteditable="false"]:not(.fr-element)').length)return!0;if(a&&"touchend"==a.type&&Ie)return!0;if(a&&t.edit.isDisabled())return a.stopPropagation(),a.preventDefault(),!1;for(var i=0;i<e.FE.INSTANCES.length;i++)e.FE.INSTANCES[i]!=t&&e.FE.INSTANCES[i].events.trigger("image.hideResizer");t.toolbar.disable(),a&&(a.stopPropagation(),a.preventDefault()),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur()),t.opts.iframe&&t.size.syncIframe(),me=e(this),de(),f(),r(),t.selection.clear(),t.button.bulkRefresh(),t.events.trigger("video.hideResizer")}function ee(e){me&&(ie()||e===!0)&&(t.toolbar.enable(),ce.removeClass("fr-active"),t.popups.hide("image.edit"),me=null,ae())}function te(){De=!0}function ae(){De=!1}function ie(){return De}function re(e){me.removeClass("fr-fir fr-fil"),"left"==e?me.addClass("fr-fil"):"right"==e&&me.addClass("fr-fir"),f(),r()}function ne(e){me&&(me.hasClass("fr-fil")?e.find("> *:first").replaceWith(t.icon.create("align-left")):me.hasClass("fr-fir")?e.find("> *:first").replaceWith(t.icon.create("align-right")):e.find("> *:first").replaceWith(t.icon.create("align-justify")))}function se(e,t){if(me){var a="justify";me.hasClass("fr-fil")?a="left":me.hasClass("fr-fir")&&(a="right"),t.find('.fr-command[data-param1="'+a+'"]').addClass("fr-active")}}function oe(e){me.removeClass("fr-dii fr-dib"),"inline"==e?me.addClass("fr-dii"):"block"==e&&me.addClass("fr-dib"),f(),r()}function le(e,t){var a="block";me.hasClass("fr-dii")&&(a="inline"),t.find('.fr-command[data-param1="'+a+'"]').addClass("fr-active")}function fe(){var a=t.popups.get("image.insert");a||(a=O()),t.popups.isVisible("image.insert")||(v(),t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",e(t.opts.scrollableContainer)));var i=me.offset().left+me.width()/2,r=me.offset().top+me.height();t.popups.show("image.insert",i,r,me.outerHeight())}function de(){if(me){t.selection.clear();var e=t.doc.createRange();e.selectNode(me.get(0));var a=t.selection.get();a.addRange(e)}}function pe(){me?(e(".fr-popup input:focus").blur(),C(me)):(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("image.insert"),t.toolbar.showInline())}function ge(){return me}function ue(e,a,i){if("undefined"==typeof a&&(a=t.opts.imageStyles),"undefined"==typeof i&&(i=t.opts.imageMultipleStyles),!me)return!1;if(!i){var r=Object.keys(a);r.splice(r.indexOf(e),1),me.removeClass(r.join(" "))}me.toggleClass(e),C(me)}var me,ce,he,ve,be=!1,ye=1,we=2,Ce=3,Ee=4,Ae=5,Se=6,Re=7,$e={};$e[ye]="Image cannot be loaded from the passed link.",$e[we]="No link in upload response.",$e[Ce]="Error during file upload.",$e[Ee]="Parsing response failed.",$e[Ae]="File is too large.",$e[Se]="Image file type is invalid.",$e[Re]="Files can be uploaded only to same domain in IE 8 and IE 9.";var xe,Ie,De=!1;return{_init:q,showInsertPopup:i,showLayer:j,refreshUploadButton:X,refreshByURLButton:G,upload:U,insertByURL:w,align:re,refreshAlign:ne,refreshAlignOnShow:se,display:oe,refreshDisplayOnShow:le,replace:fe,back:pe,get:ge,insert:A,showProgressBar:h,remove:Y,hideProgressBar:v,applyStyle:ue,showAltPopup:T,showSizePopup:M,setAlt:L,setSize:H,exitEdit:ee,edit:C}},e.FE.DefineIcon("insertImage",{NAME:"image"}),e.FE.RegisterShortcut(80,"insertImage"),e.FE.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refershAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),e.FE.DefineIcon("imageUpload",{NAME:"upload"}),e.FE.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.FE.DefineIcon("imageByURL",{NAME:"link"}),e.FE.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.FE.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){var t=this.image.get();t?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),e.FE.DefineIcon("imageDisplay",{NAME:"star"}),e.FE.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.FE.DefineIcon("imageAlign",{NAME:"align-center"}),e.FE.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",justify:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list">',a=e.FE.COMMANDS.imageAlign.options;for(var i in a)a.hasOwnProperty(i)&&(t+='<li><a class="fr-command fr-title" data-cmd="imageAlign" data-param1="'+i+'" title="'+this.language.translate(a[i])+'">'+this.icon.create("align-"+i)+"</a></li>");return t+="</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.FE.DefineIcon("imageReplace",{NAME:"exchange"}),e.FE.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.FE.DefineIcon("imageRemove",{NAME:"trash"}),e.FE.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.FE.DefineIcon("imageBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){var t=this.image.get();t||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FE.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),e.FE.DefineIcon("imageStyle",{NAME:"magic"}),e.FE.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list">',t=this.opts.imageStyles;for(var a in t)t.hasOwnProperty(a)&&(e+='<li><a class="fr-command" data-cmd="imageStyle" data-param1="'+a+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(t,a){var i=this.image.get();i&&a.find(".fr-command").each(function(){var t=e(this).data("param1");e(this).toggleClass("fr-active",i.hasClass(t))})}}),e.FE.DefineIcon("imageAlt",{NAME:"info"}),e.FE.RegisterCommand("imageAlt",{undo:!1,focus:!1,title:"Alternate Text",callback:function(){this.image.showAltPopup()}}),e.FE.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.FE.DefineIcon("imageSize",{NAME:"arrows-alt"}),e.FE.RegisterCommand("imageSize",{undo:!1,focus:!1,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.FE.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}})});